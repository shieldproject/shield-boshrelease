set -e -x

echo "Extracting archive..."
tar xzf postgres/postgresql-*.tar.gz

cd postgresql-*/

if [[ `uname -a` =~ "x86_64" || `uname -a` =~ "ppc64le" ]] ; then
  ./configure --prefix=${BOSH_INSTALL_TARGET}
else
  CFLAGS=-m32 LDFLAGS=-m32 CXXFLAGS=-m32 ./configure --prefix=${BOSH_INSTALL_TARGET}
fi

pushd src/bin/pg_config
make
make install
popd

cp -LR src/include ${BOSH_INSTALL_TARGET}
pushd src/interfaces/libpq
make
make install
popd

pushd src
make
make install
popd

pushd contrib
make
make install
popd
