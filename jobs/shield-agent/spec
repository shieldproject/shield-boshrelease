---
name: shield-agent
packages:
  - shield
  - bsdtar
  - plugins
  - generated_daemon_key
  - generated_agent_key
  - elasticsearch-cloud-aws-plugin
templates:
  bin/ctl: bin/ctl
  bin/monit_debugger: bin/monit_debugger
  bin/post-start.erb: bin/post-start
  bin/emergency-recovery.erb: bin/emergency-recovery
  config/target.json.erb: config/target.json
  config/shield-agent.conf.erb: config/shield-agent.conf
  data/properties.sh.erb: data/properties.sh
  helpers/ctl_setup.sh: helpers/ctl_setup.sh
  helpers/ctl_utils.sh: helpers/ctl_utils.sh

properties:

  shield.agent.port:
    description: "port to run agent"
    default: 5444
  shield.agent.authorized_keys:
    description: "public keys to permit"
    default: []
  shield.agent.authorize_generated_daemon_key:
    description: "permit access via generated worker key, local to deployment"
    default: true
  shield.agent.autoprovision:
    description: "Optional HTTP API of the Shield installation to automatically provision authorized keys from"
  shield.agent.recovery.target_plugin:
    description: "Target plugin to use in emergency-recovery-mode"
  shield.agent.recovery.target_config:
    description: "A map of key-values that will be converted to JSON, representing the target plugin configration"
  shield.agent.recovery.store_plugin:
    description: "Store plugin to use in emergency-recovery-mode"
  shield.agent.recovery.store_config:
    description: "A map of key-values that will be converted to JSON, representing the store plugin configration"

  shield.log_level:
    description: "Log level for shield processes"
    default: "info"
  shield.provisioning_key:
    description: "API Key to use when provisioning jobs, or targets. Required if shield.target or shield.job have data"
  shield.skip_ssl_verify:
    description: "Boolean to determine if SSL certs will be ignored when provisioning SHIELD data"
    default: true

  shield.target.name:
    description: "Target name"
  shield.target.plugin:
    description: "Plugin type"
  shield.target.config:
    description: "Hash of config information"

  shield.job.name:
    description: "Job name"
  shield.job.schedule:
    description: "Name of job schedule"
  shield.job.store:
    description: "Name of job store"
  shield.job.retention:
    description: "Name of job retention"
